var scene, scene2, renderer, camera, controls, groups, visibility, group, insetwidth, insetheight, size, travel, floor_btn, room1, room2, pathPoints, findPathButton;

const extrudeSettings = {
    steps: 2,
    depth: 30,
    bevelEnabled: false
};

const path = [[-1160, 436, 20], [-1162, 436, 20], [-1164, 436, 20], [-1166, 436, 20], [-1168, 436, 20], [-1170, 436, 20], [-1172, 436, 20], [-1174, 436, 20], [-1176, 436, 20], [-1178, 436, 20], [-1180, 436, 20], [-1182, 436, 20], [-1184, 436, 20], [-1186, 436, 20], [-1188, 436, 20], [-1190, 436, 20], [-1192, 436, 20], [-1194, 436, 20], [-1196, 436, 20], [-1198, 436, 20], [-1200, 436, 20], [-1202, 436, 20], [-1202, 438, 20], [-1202, 440, 20], [-1202, 442, 20], [-1202, 444, 20], [-1202, 446, 20], [-1202, 448, 20], [-1202, 450, 20], [-1202, 452, 20], [-1202, 454, 20], [-1202, 456, 20], [-1202, 458, 20], [-1202, 460, 20], [-1202, 462, 20], [-1202, 464, 20], [-1202, 466, 20], [-1202, 468, 20], [-1202, 470, 20], [-1202, 472, 20], [-1202, 474, 20], [-1202, 476, 20], [-1202, 478, 20], [-1202, 480, 20], [-1202, 482, 20], [-1202, 484, 20], [-1202, 486, 20], [-1202, 488, 20], [-1202, 490, 20], [-1202, 492, 20], [-1202, 494, 20], [-1202, 496, 20], [-1202, 498, 20], [-1202, 500, 20], [-1202, 502, 20], [-1202, 504, 20], [-1200, 504, 20], [-1198, 504, 20], [-1196, 504, 20], [-1194, 504, 20], [-1192, 504, 20], [-1190, 504, 20], [-1188, 504, 20], [-1186, 504, 20], [-1184, 504, 20], [-1182, 504, 20], [-1180, 504, 20], [-1178, 504, 20], [-1176, 504, 20], [-1174, 504, 20], [-1172, 504, 20], [-1170, 504, 20], [-1168, 504, 20], [-1166, 504, 20], [-1164, 504, 20], [-1162, 504, 20], [-1160, 504, 20], [-1158, 504, 20], [-1156, 504, 20], [-1154, 504, 20], [-1152, 504, 20], [-1150, 504, 20], [-1148, 504, 20], [-1146, 504, 20], [-1144, 504, 20], [-1142, 504, 20], [-1140, 504, 20], [-1138, 504, 20], [-1136, 504, 20], [-1134, 504, 20], [-1132, 504, 20], [-1130, 504, 20], [-1128, 504, 20], [-1126, 504, 20], [-1124, 504, 20], [-1122, 504, 20], [-1120, 504, 20], [-1118, 504, 20], [-1116, 504, 20], [-1114, 504, 20], [-1112, 504, 20], [-1110, 504, 20], [-1108, 504, 20], [-1106, 504, 20], [-1104, 504, 20], [-1102, 504, 20], [-1102, 502, 20], [-1102, 500, 20], [-1102, 498, 20], [-1102, 496, 20], [-1102, 494, 20], [-1102, 492, 20], [-1102, 490, 20], [-1102, 488, 20], [-1100, 488, 20], [-1098, 488, 20], [-1096, 488, 20], [-1094, 488, 20], [-1092, 488, 20], [-1090, 488, 20], [-1088, 488, 20], [-1086, 488, 20], [-1084, 488, 20], [-1082, 488, 20], [-1080, 488, 20], [-1078, 488, 20], [-1076, 488, 20], [-1074, 488, 20], [-1072, 488, 20], [-1070, 488, 20], [-1068, 488, 20], [-1068, 486, 20], [-1066, 486, 20], [-1064, 486, 20], [-1062, 486, 20], [-1060, 486, 20], [-1058, 486, 20], [-1056, 486, 20], [-1054, 486, 20], [-1052, 486, 20], [-1050, 486, 20], [-1048, 486, 20], [-1046, 486, 20], [-1044, 486, 20], [-1044, 484, 20], [-1042, 484, 20], [-1040, 484, 20], [-1038, 484, 20], [-1036, 484, 20], [-1034, 484, 20], [-1032, 484, 20], [-1030, 484, 20], [-1028, 484, 20], [-1026, 484, 20], [-1024, 484, 20], [-1022, 484, 20], [-1020, 484, 20], [-1018, 484, 20], [-1016, 484, 20], [-1014, 484, 20], [-1012, 484, 20], [-1010, 484, 20], [-1008, 484, 20], [-1006, 484, 20], [-1004, 484, 20], [-1002, 484, 20], [-1000, 484, 20], [-998, 484, 20], [-996, 484, 20], [-994, 484, 20], [-992, 484, 20], [-990, 484, 20], [-988, 484, 20], [-986, 484, 20], [-984, 484, 20], [-982, 484, 20], [-980, 484, 20], [-978, 484, 20], [-976, 484, 20], [-974, 484, 20], [-972, 484, 20], [-970, 484, 20], [-968, 484, 20], [-966, 484, 20], [-964, 484, 20], [-962, 484, 20], [-960, 484, 20], [-958, 484, 20], [-956, 484, 20], [-954, 484, 20], [-952, 484, 20], [-950, 484, 20], [-948, 484, 20], [-946, 484, 20], [-944, 484, 20], [-942, 484, 20], [-940, 484, 20], [-938, 484, 20], [-936, 484, 20], [-934, 484, 20], [-932, 484, 20], [-930, 484, 20], [-928, 484, 20], [-926, 484, 20], [-924, 484, 20], [-922, 484, 20], [-920, 484, 20], [-918, 484, 20], [-916, 484, 20], [-914, 484, 20], [-912, 484, 20], [-910, 484, 20], [-908, 484, 20], [-906, 484, 20], [-904, 484, 20], [-902, 484, 20], [-900, 484, 20], [-898, 484, 20], [-896, 484, 20], [-894, 484, 20], [-892, 484, 20], [-890, 484, 20], [-888, 484, 20], [-886, 484, 20], [-884, 484, 20], [-882, 484, 20], [-880, 484, 20], [-878, 484, 20], [-876, 484, 20], [-874, 484, 20], [-872, 484, 20], [-870, 484, 20], [-868, 484, 20], [-868, 482, 20], [-866, 482, 20], [-864, 482, 20], [-862, 482, 20], [-860, 482, 20], [-858, 482, 20], [-856, 482, 20], [-854, 482, 20], [-852, 482, 20], [-850, 482, 20], [-848, 482, 20], [-846, 482, 20], [-844, 482, 20], [-842, 482, 20], [-840, 482, 20], [-838, 482, 20], [-836, 482, 20], [-834, 482, 20], [-832, 482, 20], [-830, 482, 20], [-828, 482, 20], [-826, 482, 20], [-824, 482, 20], [-822, 482, 20], [-820, 482, 20], [-818, 482, 20], [-816, 482, 20], [-814, 482, 20], [-812, 482, 20], [-810, 482, 20], [-808, 482, 20], [-806, 482, 20], [-804, 482, 20], [-802, 482, 20], [-800, 482, 20], [-798, 482, 20], [-796, 482, 20], [-794, 482, 20], [-792, 482, 20], [-790, 482, 20], [-788, 482, 20], [-786, 482, 20], [-784, 482, 20], [-782, 482, 20], [-780, 482, 20], [-778, 482, 20], [-776, 482, 20], [-774, 482, 20], [-772, 482, 20], [-770, 482, 20], [-768, 482, 20], [-766, 482, 20], [-764, 482, 20], [-762, 482, 20], [-760, 482, 20], [-758, 482, 20], [-756, 482, 20], [-754, 482, 20], [-752, 482, 20], [-750, 482, 20], [-748, 482, 20], [-746, 482, 20], [-744, 482, 20], [-742, 482, 20], [-740, 482, 20], [-738, 482, 20], [-736, 482, 20], [-734, 482, 20], [-732, 482, 20], [-730, 482, 20], [-728, 482, 20], [-726, 482, 20], [-724, 482, 20], [-722, 482, 20], [-720, 482, 20], [-718, 482, 20], [-716, 482, 20], [-716, 480, 20], [-714, 480, 20], [-714, 478, 20], [-714, 476, 20], [-714, 474, 20], [-714, 472, 20], [-714, 470, 20], [-714, 468, 20], [-714, 466, 20], [-714, 464, 20], [-714, 462, 20], [-714, 460, 20], [-714, 458, 20], [-714, 456, 20], [-714, 454, 20], [-714, 452, 20], [-714, 450, 20], [-714, 448, 20], [-714, 446, 20], [-714, 444, 20], [-714, 442, 20], [-714, 440, 20], [-714, 438, 20], [-714, 436, 20], [-714, 434, 20], [-714, 432, 20], [-714, 430, 20], [-714, 428, 20], [-714, 426, 20], [-714, 424, 20], [-714, 422, 20], [-714, 420, 20], [-714, 418, 20], [-714, 416, 20], [-714, 414, 20], [-714, 412, 20], [-714, 410, 20], [-714, 408, 20], [-714, 406, 20], [-714, 404, 20], [-714, 402, 20], [-714, 400, 20], [-714, 398, 20], [-714, 396, 20], [-714, 394, 20], [-714, 392, 20], [-714, 390, 20], [-714, 388, 20], [-714, 386, 20], [-712, 386, 20], [-710, 386, 20], [-708, 386, 20], [-706, 386, 20], [-704, 386, 20], [-702, 386, 20], [-700, 386, 20], [-698, 386, 20], [-696, 386, 20], [-694, 386, 20], [-692, 386, 20], [-690, 386, 20], [-688, 386, 20], [-686, 386, 20], [-684, 386, 20], [-682, 386, 20], [-680, 386, 20], [-678, 386, 20], [-676, 386, 20], [-674, 386, 20], [-672, 386, 20], [-670, 386, 20], [-668, 386, 20], [-666, 386, 20], [-664, 386, 20], [-662, 386, 20], [-660, 386, 20], [-658, 386, 20], [-656, 386, 20], [-654, 386, 20], [-652, 386, 20], [-650, 386, 20], [-648, 386, 20], [-646, 386, 20], [-644, 386, 20], [-642, 386, 20], [-640, 386, 20], [-640, 384, 20], [-638, 384, 20], [-638, 382, 20], [-638, 380, 20], [-638, 378, 20], [-638, 376, 20], [-638, 374, 20], [-638, 372, 20], [-638, 370, 20], [-638, 368, 20], [-638, 366, 20], [-638, 364, 20], [-638, 362, 20], [-638, 360, 20], [-638, 358, 20], [-638, 356, 20], [-638, 354, 20], [-638, 352, 20], [-638, 350, 20], [-638, 348, 20], [-638, 346, 20], [-638, 344, 20], [-638, 342, 20], [-638, 340, 20], [-638, 338, 20], [-638, 336, 20], [-638, 334, 20], [-636, 334, 20], [-634, 334, 20], [-632, 334, 20], [-632, 332, 20], [-632, 330, 20], [-632, 328, 20], [-632, 326, 20], [-632, 324, 20], [-632, 322, 20], [-632, 320, 20], [-632, 318, 20], [-632, 316, 20], [-632, 314, 20], [-632, 312, 20], [-632, 310, 20], [-632, 308, 20], [-632, 306, 20], [-632, 304, 20], [-632, 302, 20], [-632, 300, 20], [-632, 298, 20], [-632, 296, 20], [-632, 294, 20], [-632, 292, 20], [-632, 290, 20], [-632, 288, 20], [-632, 286, 20], [-632, 284, 20], [-632, 282, 20], [-632, 280, 20], [-632, 278, 20], [-632, 276, 20], [-632, 274, 20], [-632, 272, 20], [-632, 270, 20], [-632, 268, 20], [-632, 266, 20], [-632, 264, 20], [-632, 262, 20], [-632, 260, 20], [-632, 258, 20], [-632, 256, 20], [-632, 254, 20], [-632, 252, 20], [-630, 252, 20], [-628, 252, 20], [-626, 252, 20], [-624, 252, 20], [-622, 252, 20], [-620, 252, 20], [-618, 252, 20], [-616, 252, 20], [-614, 252, 20], [-612, 252, 20], [-610, 252, 20], [-610, 250, 20], [-610, 248, 20], [-610, 246, 20], [-608, 246, 20], [-606, 246, 20], [-604, 246, 20], [-602, 246, 20], [-600, 246, 20], [-600, 244, 20], [-598, 244, 20], [-596, 244, 20], [-596, 242, 20], [-594, 242, 20], [-592, 242, 20], [-590, 242, 20], [-588, 242, 20], [-586, 242, 20], [-584, 242, 20], [-584, 240, 20], [-582, 240, 20], [-580, 240, 20], [-578, 240, 20], [-576, 240, 20], [-574, 240, 20], [-572, 240, 20], [-570, 240, 20], [-568, 240, 20], [-568, 238, 20], [-566, 238, 20], [-564, 238, 20], [-562, 238, 20], [-560, 238, 20], [-558, 238, 20], [-556, 238, 20], [-554, 238, 20], [-552, 238, 20], [-550, 238, 20], [-548, 238, 20], [-546, 238, 20], [-544, 238, 20], [-542, 238, 20], [-540, 238, 20], [-538, 238, 20], [-536, 238, 20], [-534, 238, 20], [-532, 238, 20], [-530, 238, 20], [-528, 238, 20], [-526, 238, 20], [-524, 238, 20], [-522, 238, 20], [-520, 238, 20], [-518, 238, 20], [-516, 238, 20], [-514, 238, 20], [-512, 238, 20], [-510, 238, 20], [-508, 238, 20], [-506, 238, 20], [-504, 238, 20], [-502, 238, 20], [-500, 238, 20], [-498, 238, 20], [-496, 238, 20], [-494, 238, 20], [-492, 238, 20], [-490, 238, 20], [-488, 238, 20], [-486, 238, 20], [-484, 238, 20], [-482, 238, 20], [-480, 238, 20], [-478, 238, 20], [-476, 238, 20], [-474, 238, 20], [-472, 238, 20], [-470, 238, 20], [-468, 238, 20], [-466, 238, 20], [-464, 238, 20], [-462, 238, 20], [-460, 238, 20], [-458, 238, 20], [-456, 238, 20], [-456, 236, 20], [-454, 236, 20], [-452, 236, 20], [-450, 236, 20], [-448, 236, 20], [-446, 236, 20], [-444, 236, 20], [-442, 236, 20], [-440, 236, 20], [-438, 236, 20], [-438, 234, 20], [-436, 234, 20], [-434, 234, 20], [-432, 234, 20], [-430, 234, 20], [-428, 234, 20], [-426, 234, 20], [-426, 232, 20], [-424, 232, 20], [-422, 232, 20], [-420, 232, 20], [-418, 232, 20], [-416, 232, 20], [-414, 232, 20], [-412, 232, 20], [-410, 232, 20], [-410, 230, 20], [-408, 230, 20], [-406, 230, 20], [-404, 230, 20], [-402, 230, 20], [-402, 228, 20], [-400, 228, 20], [-398, 228, 20], [-396, 228, 20], [-396, 226, 20], [-394, 226, 20], [-394, 224, 20], [-392, 224, 20], [-390, 224, 20], [-388, 224, 20], [-386, 224, 20], [-384, 224, 20], [-382, 224, 20], [-380, 224, 20], [-378, 224, 20], [-376, 224, 20], [-374, 224, 20], [-372, 224, 20], [-370, 224, 20], [-368, 224, 20], [-366, 224, 20], [-364, 224, 20], [-362, 224, 20], [-360, 224, 20], [-360, 222, 20], [-358, 222, 20], [-356, 222, 20], [-356, 220, 20], [-354, 220, 20], [-352, 220, 20], [-352, 218, 20], [-350, 218, 20], [-350, 216, 20], [-348, 216, 20], [-346, 216, 20], [-346, 214, 20], [-344, 214, 20], [-342, 214, 20], [-342, 212, 20], [-340, 212, 20], [-338, 212, 20], [-336, 212, 20], [-336, 210, 20], [-334, 210, 20], [-332, 210, 20], [-330, 210, 20], [-328, 210, 20], [-328, 208, 20], [-326, 208, 20], [-324, 208, 20], [-324, 206, 20], [-322, 206, 20], [-320, 206, 20], [-318, 206, 20], [-316, 206, 20], [-314, 206, 20], [-314, 204, 20], [-312, 204, 20], [-310, 204, 20], [-308, 204, 20], [-306, 204, 20], [-304, 204, 20], [-302, 204, 20], [-300, 204, 20], [-298, 204, 20], [-298, 202, 20], [-296, 202, 20], [-294, 202, 20], [-292, 202, 20], [-290, 202, 20], [-288, 202, 20], [-286, 202, 20], [-284, 202, 20], [-282, 202, 20], [-280, 202, 20], [-278, 202, 20], [-276, 202, 20], [-274, 202, 20], [-274, 200, 20], [-272, 200, 20], [-270, 200, 20], [-268, 200, 20], [-266, 200, 20], [-264, 200, 20], [-262, 200, 20], [-260, 200, 20], [-258, 200, 20], [-256, 200, 20], [-256, 198, 20], [-254, 198, 20], [-252, 198, 20], [-252, 200, 20], [-252, 202, 20], [-252, 204, 20], [-252, 206, 20], [-252, 208, 20], [-252, 210, 20], [-252, 212, 20], [-250, 212, 20], [-248, 212, 20], [-246, 212, 20], [-244, 212, 20], [-242, 212, 20], [-240, 212, 20], [-238, 212, 20], [-236, 212, 20], [-234, 212, 20], [-232, 212, 20], [-230, 212, 20], [-228, 212, 20], [-226, 212, 20], [-224, 212, 20], [-222, 212, 20], [-220, 212, 20], [-218, 212, 20], [-216, 212, 20], [-214, 212, 20], [-212, 212, 20], [-210, 212, 20], [-208, 212, 20], [-208, 214, 20], [-208, 216, 20], [-208, 218, 20], [-208, 220, 20], [-208, 222, 20], [-208, 224, 20], [-208, 226, 20], [-206, 226, 20], [-204, 226, 20], [-202, 226, 20], [-200, 226, 20], [-198, 226, 20], [-196, 226, 20], [-196, 224, 20], [-196, 222, 20], [-196, 220, 20], [-196, 218, 20], [-194, 218, 20], [-194, 216, 20], [-194, 214, 20], [-194, 212, 20], [-192, 212, 20], [-190, 212, 20], [-188, 212, 20], [-186, 212, 20], [-184, 212, 20], [-182, 212, 20], [-180, 212, 20], [-178, 212, 20], [-176, 212, 20], [-174, 212, 20], [-172, 212, 20], [-170, 212, 20], [-168, 212, 20], [-166, 212, 20], [-164, 212, 20], [-162, 212, 20], [-160, 212, 20], [-158, 212, 20], [-156, 212, 20], [-154, 212, 20], [-152, 212, 20], [-150, 212, 20], [-148, 212, 20], [-146, 212, 20], [-144, 212, 20], [-142, 212, 20], [-140, 212, 20], [-138, 212, 20], [-136, 212, 20], [-134, 212, 20], [-132, 212, 20], [-130, 212, 20], [-128, 212, 20], [-126, 212, 20], [-124, 212, 20], [-122, 212, 20], [-120, 212, 20], [-118, 212, 20], [-116, 212, 20], [-114, 212, 20], [-112, 212, 20], [-110, 212, 20], [-108, 212, 20], [-106, 212, 20], [-104, 212, 20], [-102, 212, 20], [-100, 212, 20], [-98, 212, 20], [-96, 212, 20], [-94, 212, 20], [-92, 212, 20], [-90, 212, 20], [-88, 212, 20], [-86, 212, 20], [-84, 212, 20], [-82, 212, 20], [-80, 212, 20], [-78, 212, 20], [-76, 212, 20], [-74, 212, 20], [-72, 212, 20], [-70, 212, 20], [-68, 212, 20], [-66, 212, 20], [-64, 212, 20], [-62, 212, 20], [-60, 212, 20], [-58, 212, 20], [-56, 212, 20], [-54, 212, 20], [-52, 212, 20], [-50, 212, 20], [-48, 212, 20], [-48, 210, 20], [-48, 208, 20], [-48, 206, 20], [-48, 204, 20], [-48, 202, 20], [-48, 200, 20], [-48, 198, 20], [-48, 196, 20], [-48, 194, 20], [-48, 192, 20], [-48, 190, 20], [-48, 188, 20], [-48, 186, 20], [-48, 184, 20], [-48, 182, 20], [-48, 180, 20], [-48, 178, 20], [-48, 176, 20], [-48, 174, 20], [-48, 172, 20], [-48, 170, 20], [-48, 168, 20], [-48, 166, 20], [-48, 164, 20], [-48, 162, 20], [-48, 160, 20], [-46, 160, 20], [-44, 160, 20], [-42, 160, 20], [-40, 160, 20], [-38, 160, 20], [-36, 160, 20], [-34, 160, 20], [-32, 160, 20], [-30, 160, 20], [-28, 160, 20], [-26, 160, 20], [-24, 160, 20], [-22, 160, 20], [-20, 160, 20], [-18, 160, 20], [-16, 160, 20], [-14, 160, 20], [-14, 158, 20], [-12, 158, 20], [-10, 158, 20], [-10, 156, 20], [-8, 156, 20], [-6, 156, 20], [-4, 156, 20], [-2, 156, 20], [-2, 154, 20], [0, 154, 20], [0, 152, 20], [2, 152, 20], [2, 150, 20], [4, 150, 20], [4, 148, 20], [6, 148, 20], [6, 146, 20], [8, 146, 20], [8, 144, 20], [10, 144, 20], [10, 142, 20], [10, 140, 20], [10, 138, 20], [10, 136, 20], [12, 136, 20], [12, 134, 20], [14, 134, 20], [16, 134, 20], [18, 134, 20], [20, 134, 20], [22, 134, 20], [24, 134, 20], [26, 134, 20], [28, 134, 20], [30, 134, 20], [32, 134, 20], [34, 134, 20], [36, 134, 20], [38, 134, 20], [40, 134, 20], [42, 134, 20], [44, 134, 20], [46, 134, 20], [48, 134, 20], [50, 134, 20], [52, 134, 20], [54, 134, 20], [56, 134, 20], [58, 134, 20], [60, 134, 20], [62, 134, 20], [64, 134, 20], [66, 134, 20], [68, 134, 20], [70, 134, 20], [72, 134, 20], [74, 134, 20], [76, 134, 20], [78, 134, 20], [78, 132, 20], [78, 130, 20], [78, 128, 20], [78, 126, 20], [78, 124, 20], [78, 122, 20], [78, 120, 20], [78, 118, 20], [78, 116, 20], [78, 114, 20], [78, 112, 20], [78, 110, 20], [78, 108, 20], [78, 106, 20], [78, 104, 20], [78, 102, 20], [78, 100, 20], [78, 98, 20], [78, 96, 20], [78, 94, 20], [78, 92, 20], [78, 90, 20], [78, 88, 20], [78, 86, 20], [78, 84, 20], [78, 82, 20], [78, 80, 20], [78, 78, 20], [78, 76, 20], [78, 74, 20], [78, 72, 20], [78, 70, 20], [78, 68, 20], [78, 66, 20], [78, 64, 20], [78, 62, 20], [78, 60, 20], [78, 58, 20], [78, 56, 20], [78, 54, 20], [78, 52, 20], [78, 50, 20], [78, 48, 20], [78, 46, 20], [78, 44, 20], [78, 42, 20], [78, 40, 20], [78, 38, 20], [78, 36, 20], [78, 34, 20], [78, 32, 20], [78, 30, 20], [78, 28, 20], [78, 26, 20], [78, 24, 20], [78, 22, 20], [78, 20, 20], [78, 18, 20], [78, 16, 20], [78, 14, 20], [78, 12, 20], [78, 10, 20], [78, 8, 20], [78, 6, 20], [78, 4, 20], [78, 2, 20], [78, 0, 20], [78, -2, 20], [78, -4, 20], [78, -6, 20], [78, -8, 20], [78, -10, 20], [78, -12, 20], [78, -14, 20], [78, -16, 20], [78, -18, 20], [78, -20, 20], [78, -22, 20], [78, -24, 20], [78, -26, 20], [78, -28, 20], [78, -30, 20], [78, -32, 20], [78, -34, 20], [78, -36, 20], [78, -38, 20], [78, -40, 20], [78, -42, 20], [78, -44, 20], [78, -46, 20], [78, -48, 20], [78, -50, 20], [78, -52, 20], [78, -54, 20], [78, -56, 20], [78, -58, 20], [78, -60, 20], [78, -62, 20], [78, -64, 20], [78, -66, 20], [78, -68, 20], [78, -70, 20], [78, -72, 20], [78, -74, 20], [78, -76, 20], [78, -78, 20], [78, -80, 20], [78, -82, 20], [78, -84, 20], [78, -86, 20], [78, -88, 20], [78, -90, 20], [78, -92, 20], [78, -94, 20], [78, -96, 20], [78, -98, 20], [78, -100, 20], [78, -102, 20], [78, -104, 20], [78, -106, 20], [78, -108, 20], [78, -110, 20], [78, -112, 20], [78, -114, 20], [78, -116, 20], [78, -118, 20], [78, -120, 20], [78, -122, 20], [78, -124, 20], [78, -126, 20], [78, -128, 20], [78, -130, 20], [78, -132, 20], [78, -134, 20], [78, -136, 20], [78, -138, 20], [78, -140, 20], [78, -142, 20], [78, -144, 20], [78, -146, 20], [78, -148, 20], [78, -150, 20], [78, -152, 20], [78, -154, 20], [78, -156, 20], [78, -158, 20], [78, -160, 20], [78, -162, 20], [78, -164, 20], [78, -166, 20], [78, -168, 20], [78, -170, 20], [78, -172, 20], [78, -174, 20], [78, -176, 20], [78, -178, 20], [78, -180, 20], [78, -182, 20], [78, -184, 20], [78, -186, 20], [78, -188, 20], [78, -190, 20], [78, -192, 20], [78, -194, 20], [78, -196, 20], [78, -198, 20], [78, -200, 20], [78, -202, 20], [78, -204, 20], [78, -206, 20], [78, -208, 20], [78, -210, 20], [78, -212, 20], [78, -214, 20], [78, -216, 20], [78, -218, 20], [78, -220, 20], [78, -222, 20], [78, -224, 20], [78, -226, 20], [78, -228, 20], [78, -230, 20], [78, -232, 20], [78, -234, 20], [78, -236, 20], [78, -238, 20], [78, -240, 20], [78, -242, 20], [78, -244, 20], [78, -246, 20], [78, -248, 20], [78, -250, 20], [78, -252, 20], [78, -254, 20], [78, -256, 20], [80, -256, 20], [82, -256, 20], [84, -256, 20], [86, -256, 20], [88, -256, 20], [90, -256, 20], [92, -256, 20], [94, -256, 20], [96, -256, 20], [98, -256, 20], [100, -256, 20], [102, -256, 20], [104, -256, 20], [106, -256, 20], [108, -256, 20], [110, -256, 20], [112, -256, 20], [114, -256, 20], [116, -256, 20], [118, -256, 20], [120, -256, 20], [122, -256, 20], [124, -256, 20], [126, -256, 20], [128, -256, 20], [130, -256, 20], [132, -256, 20], [134, -256, 20], [136, -256, 20], [138, -256, 20], [140, -256, 20], [142, -256, 20], [144, -256, 20], [146, -256, 20], [148, -256, 20], [150, -256, 20], [152, -256, 20], [154, -256, 20], [156, -256, 20], [158, -256, 20], [160, -256, 20], [162, -256, 20], [164, -256, 20], [166, -256, 20], [168, -256, 20], [170, -256, 20], [172, -256, 20], [174, -256, 20], [176, -256, 20], [178, -256, 20], [180, -256, 20], [182, -256, 20], [184, -256, 20], [186, -256, 20], [188, -256, 20], [190, -256, 20], [192, -256, 20], [194, -256, 20], [196, -256, 20], [198, -256, 20], [200, -256, 20], [202, -256, 20], [204, -256, 20], [206, -256, 20], [208, -256, 20], [210, -256, 20], [212, -256, 20], [214, -256, 20], [216, -256, 20], [218, -256, 20], [220, -256, 20], [222, -256, 20], [222, -258, 20], [224, -258, 20], [226, -258, 20], [226, -260, 20], [228, -260, 20], [230, -260, 20], [232, -260, 20], [234, -260, 20], [236, -260, 20], [238, -260, 20], [240, -260, 20], [242, -260, 20], [244, -260, 20], [246, -260, 20], [248, -260, 20], [250, -260, 20], [252, -260, 20], [254, -260, 20], [256, -260, 20], [258, -260, 20], [260, -260, 20], [262, -260, 20], [264, -260, 20], [266, -260, 20], [268, -260, 20], [270, -260, 20], [272, -260, 20], [274, -260, 20], [276, -260, 20], [278, -260, 20], [280, -260, 20], [282, -260, 20], [284, -260, 20], [286, -260, 20], [288, -260, 20], [290, -260, 20], [292, -260, 20], [294, -260, 20], [296, -260, 20], [298, -260, 20], [300, -260, 20], [302, -260, 20], [304, -260, 20], [306, -260, 20], [308, -260, 20], [310, -260, 20], [312, -260, 20], [314, -260, 20], [316, -260, 20], [318, -260, 20], [320, -260, 20], [322, -260, 20], [324, -260, 20], [326, -260, 20], [328, -260, 20], [330, -260, 20], [332, -260, 20], [334, -260, 20], [336, -260, 20], [338, -260, 20], [340, -260, 20], [342, -260, 20], [344, -260, 20], [346, -260, 20], [348, -260, 20], [350, -260, 20], [352, -260, 20], [354, -260, 20], [356, -260, 20], [358, -260, 20], [360, -260, 20], [362, -260, 20], [364, -260, 20], [366, -260, 20], [368, -260, 20], [370, -260, 20], [372, -260, 20], [374, -260, 20], [376, -260, 20], [378, -260, 20], [380, -260, 20], [382, -260, 20], [384, -260, 20], [386, -260, 20], [388, -260, 20], [390, -260, 20], [392, -260, 20], [394, -260, 20], [396, -260, 20], [398, -260, 20], [400, -260, 20], [402, -260, 20], [404, -260, 20], [404, -262, 20], [406, -262, 20], [406, -264, 20], [406, -266, 20], [406, -268, 20], [408, -268, 20], [410, -268, 20], [412, -268, 20], [414, -268, 20], [416, -268, 20], [418, -268, 20], [420, -268, 20], [422, -268, 20], [424, -268, 20], [426, -268, 20], [428, -268, 20], [430, -268, 20], [432, -268, 20], [434, -268, 20], [436, -268, 20], [436, -270, 20], [438, -270, 20], [438, -272, 20], [440, -272, 20], [442, -272, 20], [444, -272, 20], [446, -272, 20], [448, -272, 20], [450, -272, 20], [452, -272, 20], [454, -272, 20], [456, -272, 20], [458, -272, 20], [460, -272, 20], [462, -272, 20], [464, -272, 20], [466, -272, 20], [468, -272, 20], [470, -272, 20], [472, -272, 20], [474, -272, 20], [476, -272, 20], [478, -272, 20], [480, -272, 20], [482, -272, 20], [484, -272, 20], [486, -272, 20], [488, -272, 20], [490, -272, 20], [492, -272, 20], [494, -272, 20], [496, -272, 20], [498, -272, 20], [500, -272, 20], [502, -272, 20], [504, -272, 20], [504, -274, 20], [504, -276, 20], [504, -278, 20], [504, -280, 20], [504, -282, 20], [504, -284, 20], [504, -286, 20], [504, -288, 20], [504, -290, 20], [504, -292, 20], [506, -292, 20], [508, -292, 20], [510, -292, 20], [512, -292, 20], [514, -292, 20], [516, -292, 20], [518, -292, 20], [520, -292, 20], [522, -292, 20], [524, -292, 20], [526, -292, 20], [528, -292, 20], [530, -292, 20], [532, -292, 20], [534, -292, 20], [536, -292, 20], [538, -292, 20], [540, -292, 20], [542, -292, 20], [544, -292, 20], [546, -292, 20], [548, -292, 20], [550, -292, 20], [552, -292, 20], [554, -292, 20], [556, -292, 20], [558, -292, 20], [560, -292, 20], [562, -292, 20], [564, -292, 20], [566, -292, 20], [568, -292, 20], [570, -292, 20], [572, -292, 20], [574, -292, 20], [576, -292, 20], [578, -292, 20], [580, -292, 20], [582, -292, 20], [584, -292, 20], [586, -292, 20], [588, -292, 20], [590, -292, 20], [592, -292, 20], [594, -292, 20], [596, -292, 20], [598, -292, 20], [600, -292, 20], [602, -292, 20], [604, -292, 20], [606, -292, 20], [608, -292, 20], [610, -292, 20], [612, -292, 20], [614, -292, 20], [616, -292, 20], [618, -292, 20], [620, -292, 20], [622, -292, 20], [624, -292, 20], [626, -292, 20], [628, -292, 20], [630, -292, 20], [632, -292, 20], [634, -292, 20], [636, -292, 20], [638, -292, 20], [640, -292, 20], [642, -292, 20], [644, -292, 20], [646, -292, 20], [648, -292, 20], [650, -292, 20], [652, -292, 20], [654, -292, 20], [656, -292, 20], [658, -292, 20], [660, -292, 20], [662, -292, 20], [664, -292, 20], [666, -292, 20], [668, -292, 20], [670, -292, 20], [672, -292, 20], [674, -292, 20], [676, -292, 20], [678, -292, 20], [680, -292, 20], [682, -292, 20], [684, -292, 20], [686, -292, 20], [688, -292, 20]];
const multiplier = 2; // Multiply size of rendered model

var n = 0; // Index of current camera position on path

var lookahead = 15; // How far the camera looks ahead

var mid_x = 652;
var mid_y = 380;

function addText(text, x, y, group, floor, mid_x, mid_y) {
    /* Function to add room names at certain locations */
    
    var loader = new THREE.FontLoader();
    loader.load('https://threejs.org/examples/fonts/optimer_regular.typeface.json', function(font) {

        var textGeo = new THREE.TextGeometry(text, {
            font: font,
            size: 20,
            height: 1,
        });
        var textMaterial = new THREE.MeshPhongMaterial({
            color: 0x000000,
            visible: true
        });
        var mesh = new THREE.Mesh(textGeo, textMaterial);
        mesh.position.set((x - mid_x) * multiplier, (mid_y - y) * multiplier, 50+floor*50);
        mesh.name = "text1";
        mesh.layers.set(1);
        group.add(mesh);
        
        mesh = new THREE.Mesh(textGeo, textMaterial);
        mesh.position.set((x - mid_x) * multiplier, (mid_y - y) * multiplier, 50+floor*50);
        mesh.name = "text2";
        mesh.layers.set(2);
        group.add(mesh);
    });
};

function addLines(points, group, floor) {
    /* Function add walls at certain locations */
    
    let x1, y1, x2, y2, w;
    x1 = points[0];
    y1 = points[1];
    x2 = points[2];
    y2 = points[3];
    w = points[4] + 1;
    const shape = new THREE.Shape();
    shape.moveTo((x1 - mid_x) * multiplier, (mid_y - y1) * multiplier);
    shape.lineTo((x2 - mid_x) * multiplier, (mid_y - y2) * multiplier);
    shape.lineTo((x2 - mid_x + w) * multiplier, (mid_y - y2) * multiplier);
    shape.lineTo((x1 - mid_x + w) * multiplier, (mid_y - y1) * multiplier);
    shape.lineTo((x1 - mid_x) * multiplier, (mid_y - y1) * multiplier);

    const geometry = new THREE.ExtrudeGeometry(shape, extrudeSettings);
    const material = new THREE.MeshPhongMaterial({
        color: 0xffffff
    });
    const mesh = new THREE.Mesh(geometry, material);
    mesh.castShadow = true;
    mesh.receiveShadow = true;
    mesh.position.set(0, 0, floor*50);
    group.add(mesh);
};

function changeFloor() {
    if (floor_btn.value == "All Floors") {
        for (let i = 0; i < groups.length; i++) {
            groups[i].visible = true;
        }
    }
    else{
        for (let i = 0; i < groups.length; i++) {
            groups[i].visible = false;
        }
        visibility = floor_btn.value;
        groups[floor_btn.value].visible = true;
    }
};

function resize() {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight)

    insetwidth = window.innerWidth / 3;
    insetheight = window.innerHeight / 3;
    camera_first.aspect = insetwidth/insetheight;
    camera_first.updateProjectionMatrix();
}

function toggle_navigation() {
    if (travel) {
        travel = false
    } else {
        travel = true
    }
}

function animate() {
    requestAnimationFrame(animate);
    controls.update();
    scene.traverse (function (object) {
        if (object instanceof THREE.Mesh) {
            if (object.name == "text1") {
                object.quaternion.copy( camera.quaternion );
            }
            if (object.name == "text2") {
                object.quaternion.copy( camera_first.quaternion );
            }
        }
    });
    renderer.setViewport(0, 0, window.innerWidth, window.innerHeight)
    renderer.render(scene, camera);
    renderer.clearDepth();
    renderer.setScissorTest(true);
    renderer.setScissor(
        window.innerWidth - insetwidth - 16,
        window.innerHeight - insetheight - 16,
        insetwidth,
        insetheight,
    );
    renderer.setViewport(
        window.innerWidth - insetwidth - 16,
        window.innerHeight - insetheight - 16,
        insetwidth,
        insetheight,
    );
    renderer.render(scene, camera_first);
    renderer.setScissorTest(false);
    
    // Move first person view camera
    
    if (travel) {
        if (n < path.length) {
            camera_first.position.set(path[n][0], path[n][1], 20+Math.sin(n/6));
            camera_first.lookAt(path[n + lookahead][0], path[n + lookahead][1], 20+Math.sin(n/6));
            
            pathPoints[n + lookahead].material.color.setHex(0xff0000);
        }

        if (n>1){
            if (camera_first.rotation.x>1){
                camera_first.rotation.x = Math.PI / 2;
                camera_first.rotation.z = 0;
            }
            else{
                camera_first.rotation.x = -Math.PI / 2;
                camera_first.rotation.z = Math.PI;
            }
        }
        
        n++;
    }
};

function findPath() {
    console.log(room1.value);
    console.log(room2.value);
}

function render_model(model) {
    
    $('#loadingText').html("Rendering model...");
    
    //Get JSON model attributes
    const num_floors = model["num_floors"];
    
    // Setting initial values
    
    visibility = 0;
    size = 20;
    travel = false;
    groups = new Array();
    
    // Create Three.js renderer
    
    renderer = new THREE.WebGLRenderer();
    renderer.setPixelRatio(window.devicePixelRatio); //get the correct pixel detail on portable devices
    renderer.domElement.style.position = "absolute";
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setClearColor(0xefebd9, 1); // Default background color
    document.body.appendChild(renderer.domElement);
    
    // Create Three.js scene
    
    scene = new THREE.Scene();
    const axesHelper = new THREE.AxesHelper(400);
    scene.add(axesHelper);
    
    // Bird eye view camera
    
    camera = new THREE.PerspectiveCamera(
        90, //FOV
        window.innerWidth / window.innerHeight, //aspect
        1, //near clipping plane
        25000 //far clipping plane
    );
    camera.layers.enable(1);
    camera.position.set(0, 0, 750);
    camera.lookAt(0, 0, 0);
    
    // First person view camera
    
    camera_first = new THREE.PerspectiveCamera(
        90, //FOV
        window.innerWidth / window.innerHeight, //aspect
        1, //near clipping plane
        2500 //far clipping plane
    );
    camera_first.layers.enable(2);
    camera_first.position.set(path[0][0], path[0][1], path[0][2]);
    camera_first.rotation.x = Math.PI / 2;
    camera_first.rotation.z = 0;
    
    const camera_first_helper = new THREE.CameraHelper(camera_first); // Show where first person view camera is
    scene.add(camera_first_helper);
    
    // Create GUI
    
    floor_btn = document.createElement("select");
    floor_btn.add = "Floor 1";
    floor_btn.add = "Floor 2";
    floor_btn.setAttribute("id", "currentFloor");
    floor_btn.setAttribute("name", "Floor");
    document.body.appendChild(floor_btn);
    floor_btn.addEventListener("change", changeFloor);
    floor_btn.style.backgroundColor = "white";
    floor_btn.style.position = "absolute";
    
    room1 = document.createElement("input");
    room1.style.position = "absolute";
    room1.style.top = "100px";
    room1.placeholder = "Start...";
    document.body.appendChild(room1);
    room2 = document.createElement("input");
    room2.style.position = "absolute";
    room2.style.top = "150px";
    room2.placeholder = "End...";
    document.body.appendChild(room2);

    findPathButton = document.createElement('button');
    findPathButton.style.position = "absolute";
    findPathButton.style.top = "200px";
    findPathButton.innerHTML = "Find path";
    document.body.appendChild(findPathButton);
    findPathButton.addEventListener("click", findPath);    
    
    var newOption = document.createElement("option");
    newOption.setAttribute("value", "All Floors");
    node = document.createTextNode("All Floors");
    newOption.appendChild(node);
    document.getElementById("currentFloor").appendChild(newOption);

    // Allow camera to be maneuvered
    
    controls = new THREE.TrackballControls(camera, renderer.domElement);
    // controls.rotateSpeed = 0; // Prevent camera rotation 
    
    const color = 0xFFFFFF;
    const intensity = 1.5;
    const light = new THREE.DirectionalLight(color, intensity);
    light.position.set(400, 400, 800);
    light.target.position.set(0, 0, 0);
    light.castShadow = true;
    scene.add(light);
    scene.add(light.target);
    const light_helper = new THREE.DirectionalLightHelper(light, 200);
    scene.add(light_helper);
   
    for (let i = 0; i < num_floors; i++) {
        let list_of_text = model[(i + 1).toString()]["rooms"];
        let list_of_points = model[(i + 1).toString()]["points"];
        group = new THREE.Group();
        var newOption = document.createElement("option");
        newOption.setAttribute("value", i);
        node = document.createTextNode("Floor " + String(i + 1));
        newOption.appendChild(node);
        document.getElementById("currentFloor").appendChild(newOption);
        for (let j = 0; j < list_of_points.length; j++) {
            addLines(list_of_points[j], group, i);
        }
        for (let j = 0; j < list_of_text.length; j++){
            addText(list_of_text[j][0], list_of_text[j][1], list_of_text[j][2], group, i, mid_x, mid_y);
        }
        scene.add(group);
        groups.push(group);
        mid_x = 424;
        mid_y = 351;
    }

    pathPoints = [];
    
    for(let i = 0; i < path.length; i++) {
        var dotGeometry = new THREE.BufferGeometry();
        dotGeometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array([path[i][0], path[i][1], path[i][2] - 20]), 3));
        var dotMaterial = new THREE.PointsMaterial({ size: 1, color: 0x0000ff });
        var dot = new THREE.Points(dotGeometry, dotMaterial);
        pathPoints.push(dot);
        scene.add(dot);
    }
   
    resize();
    animate();  
    renderer.domElement.addEventListener("click", toggle_navigation);
    window.addEventListener("resize", resize);
    $('#loadingScreen').remove();
}